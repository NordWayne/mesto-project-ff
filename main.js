(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,n(o.key),o)}}function n(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var r=function(){return e=function e(t){var n=t.baseUrl,r=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=n,this._headers=r},(n=[{key:"getUserInfo",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/users/me "),{headers:this._headers}).then((function(t){return e._checkResponse(t)}))}},{key:"editUserInfo",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return n._checkResponse(e)}))}},{key:"editUserAvatar",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((function(e){return t._checkResponse(e)}))}},{key:"getInitialCards",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((function(t){return e._checkResponse(t)}))}},{key:"addCard",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return n._checkResponse(e)}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._checkResponse(e)}))}},{key:"likeCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((function(e){return t._checkResponse(e)}))}},{key:"unlikeCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._checkResponse(e)}))}},{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Возникла ошибка: ".concat(e.status))}}])&&t(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}(),o=new r({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"76a4dd5f-64dc-4a0f-a5d3-565c2f5e1f91","Content-Type":"application/json"}});function i(e,t,n,r,o,i){var a=n.content.querySelector(".card").cloneNode(!0),c=a.querySelector(".card__image"),u=a.querySelector(".card__title"),s=a.querySelector(".card__delete-button"),l=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-counter");return d.textContent=e.likes.length,e.owner._id!==i&&s.remove(),e.likes.some((function(e){return e._id===i}))&&l.classList.add("card__like-button_is-active"),c.src=e.link,c.alt=e.name,u.textContent=e.name,s.addEventListener("click",(function(){return t(a,e._id)})),l.addEventListener("click",(function(t){r(l,e,d,t)})),c.addEventListener("click",(function(){o(e)})),a}function a(e,t){o.deleteCard(t).then((function(){e.remove()}))}function c(e,t,n,r){r.target.classList.contains("card__like-button_is-active")?o.unlikeCard(t._id).then((function(t){e.classList.remove("card__like-button_is-active"),n.textContent=t.likes.length})):o.likeCard(t._id).then((function(t){e.classList.add("card__like-button_is-active"),n.textContent=t.likes.length}))}function u(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",d)}function s(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",d)}function l(e,t){e.target===t&&s(t)}function d(e){"Escape"===e.key&&s(document.querySelector(".popup_is-opened"))}function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_(r.key),r)}}function _(e){var t=function(e){if("object"!=p(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:t+""}var h,y=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.form=n,this.submitButton=this.form.querySelector(this.config.submitButtonSelector),this._inputsList=this.form.querySelectorAll(this.config.inputSelector),this._nameRegex=/^[a-zA-Zа-яА-ЯёЁ\s-]+$/},(t=[{key:"_showError",value:function(e){this.form.querySelector("#".concat(e.name,"-error")).textContent=e.validationMessage,e.classList.add(this.config.inputInvalidClass)}},{key:"_hideError",value:function(e){this.form.querySelector("#".concat(e.name,"-error")).textContent="",e.classList.remove(this.config.inputInvalidClass)}},{key:"_checkInputValidity",value:function(e){"name"!==e.name&&"description"!==e.name&&"place-name"!==e.name||(this._nameRegex.test(e.value)?e.setCustomValidity(""):e.setCustomValidity("Поле может содержать только латинские и кириллические буквы, знаки дефиса и пробелы")),e.validity.valid?this._hideError(e):this._showError(e)}},{key:"setButtonState",value:function(e,t,n){t?(e.classList.remove(n.buttonInvalidClass),e.disabled=!1):(e.classList.add(n.buttonInvalidClass),e.disabled=!0)}},{key:"_setEventListeners",value:function(){var e=this;this._inputsList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e.setButtonState(e.submitButton,e.form.checkValidity(),e.config)}))}))}},{key:"enableValidation",value:function(){this._setEventListeners(),this.setButtonState(this.submitButton,this.form.checkValidity(),this.config)}},{key:"resetValidation",value:function(){var e=this;this._inputsList.forEach((function(t){e._hideError(t)})),this.setButtonState(this.submitButton,!1,this.config)}}])&&f(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),v=document.querySelector("#card-template"),m=document.querySelector(".places__list"),b=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),S=k.querySelector(".popup__close"),q=k.querySelector(".popup__form"),C=q.querySelector(".popup__button"),E=document.querySelector(".profile__add-button"),g=document.querySelector(".popup_type_new-card"),L=g.querySelector(".popup__close"),w=g.querySelector(".popup__form"),x=w.querySelector(".popup__button"),U=document.querySelector(".profile__image"),V=document.querySelector(".popup_type_avatar"),I=V.querySelector(".popup__close"),P=V.querySelector(".popup__form"),j=P.querySelector("#avatarLink"),T=P.querySelector(".popup__button"),B=document.querySelector(".popup_type_image"),R=B.querySelector(".popup__close"),O=B.querySelector(".popup__image"),A=B.querySelector(".popup__caption"),D=q.querySelector(".popup__input_type_name"),N=q.querySelector(".popup__input_type_description"),z=w.querySelector(".popup__input_type_card-name"),J=document.querySelector(".profile__title"),H=document.querySelector(".profile__description"),M=document.querySelector(".popup__input_type_url"),Z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputInvalidClass:"popup__input_state_invalid",buttonInvalidClass:"popup__button_invalid"},$=new y(Z,k.querySelector(".popup__form"));$.enableValidation();var F=new y(Z,g.querySelector(".popup__form"));F.enableValidation();var G=new y(Z,k.querySelector(".popup__form"));G.enableValidation();var K=new y(Z,V.querySelector(".popup__form"));K.enableValidation();var Q=new r({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"76a4dd5f-64dc-4a0f-a5d3-565c2f5e1f91","Content-Type":"application/json"}});function W(e,t,n){J.textContent=e,H.textContent=t,n&&(U.style.backgroundImage="url(".concat(n,")"))}function X(e){O.src=e.link,O.alt=e.name,A.textContent=e.name,u(B)}Q.getInitialCards().then((function(e){e.forEach((function(e){var t=i(e,a,v,c,X,h);m.append(t)}))})),Q.getUserInfo().then((function(e){W(e.name,e.about,e.avatar),h=e._id})),b.addEventListener("click",(function(){var e={name:J.textContent,description:H.textContent},t=e.name,n=e.description;D.value=t,N.value=n,u(k),$.resetValidation()})),q.addEventListener("submit",(function(e){return function(e,t){e.preventDefault(),C.textContent="Сохранение...",Q.editUserInfo(D.value,N.value).then((function(e){W(e.name,e.about)})).finally((function(){s(t),C.textContent="Сохранить"}))}(e,k)})),S.addEventListener("click",(function(){return s(k)})),E.addEventListener("click",(function(){u(g),F.resetValidation()})),L.addEventListener("click",(function(){return s(g)})),w.addEventListener("submit",(function(e){return function(e,t,n){e.preventDefault();var r=e.target,o={name:z.value,link:M.value};x.textContent="Сохранение...",Q.addCard(o.name,o.link).then((function(e){var t=i(e,a,n,c,X,h);m.insertBefore(t,m.firstChild)})).finally((function(){x.textContent="Сохранить",r.reset(),s(t)}))}(e,g,v)})),R.addEventListener("click",(function(){return s(B)})),k.addEventListener("click",(function(e){return l(e,k)})),g.addEventListener("click",(function(e){return l(e,g)})),B.addEventListener("click",(function(e){return l(e,B)})),V.addEventListener("click",(function(e){return l(e,V)})),U.addEventListener("click",(function(){u(V),G.resetValidation()})),I.addEventListener("click",(function(){return s(V)})),P.addEventListener("submit",(function(e){return function(e){e.preventDefault(),T.textContent="Сохранение...",K.resetValidation(),Q.editUserAvatar(j.value).then((function(e){W(e.name,e.about,e.avatar)})).finally((function(){s(V),T.textContent="Сохранить"}))}(e)}))})();