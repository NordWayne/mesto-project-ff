(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,n(o.key),o)}}function n(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var r=new(function(){return e=function e(t){var n=t.baseUrl,r=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=n,this._headers=r},(n=[{key:"getUserInfo",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/users/me "),{headers:this._headers}).then((function(t){return e._checkResponse(t)}))}},{key:"editUserInfo",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return n._checkResponse(e)}))}},{key:"editUserAvatar",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((function(e){return t._checkResponse(e)}))}},{key:"getInitialCards",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((function(t){return e._checkResponse(t)}))}},{key:"addCard",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return n._checkResponse(e)}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._checkResponse(e)}))}},{key:"likeCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((function(e){return t._checkResponse(e)}))}},{key:"unlikeCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._checkResponse(e)}))}},{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Возникла ошибка: ".concat(e.status))}}])&&t(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"76a4dd5f-64dc-4a0f-a5d3-565c2f5e1f91","Content-Type":"application/json"}});function o(e,t,n,r,o,i){var a=n.content.querySelector(".card").cloneNode(!0),c=a.querySelector(".card__image"),u=a.querySelector(".card__title"),s=a.querySelector(".card__delete-button"),l=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-counter");return d.textContent=e.likes.length,e.owner._id!==i&&s.remove(),e.likes.some((function(e){return e._id===i}))&&l.classList.add("card__like-button_is-active"),c.src=e.link,c.alt=e.name,u.textContent=e.name,s.addEventListener("click",(function(){return t(a,e._id)})),l.addEventListener("click",(function(t){r(l,e,d,t)})),c.addEventListener("click",(function(){o(e)})),a}function i(e,t){r.deleteCard(t).then((function(){e.remove()})).catch((function(e){console.log(e)}))}function a(e,t,n,o){o.target.classList.contains("card__like-button_is-active")?r.unlikeCard(t._id).then((function(t){e.classList.remove("card__like-button_is-active"),n.textContent=t.likes.length})).catch((function(e){console.log(e)})):r.likeCard(t._id).then((function(t){e.classList.add("card__like-button_is-active"),n.textContent=t.likes.length})).catch((function(e){console.log(e)}))}function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",l)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)}function s(e,t){e.target===t&&u(t)}function l(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,p(r.key),r)}}function p(e){var t=function(e){if("object"!=d(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==d(t)?t:t+""}var h=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.form=n,this.submitButton=this.form.querySelector(this.config.submitButtonSelector),this._inputsList=this.form.querySelectorAll(this.config.inputSelector),this._nameRegex=/^[a-zA-Zа-яА-ЯёЁ\s-]+$/},(t=[{key:"_showError",value:function(e){this.form.querySelector("#".concat(e.name,"-error")).textContent=e.validationMessage,e.classList.add(this.config.inputInvalidClass)}},{key:"_hideError",value:function(e){this.form.querySelector("#".concat(e.name,"-error")).textContent="",e.classList.remove(this.config.inputInvalidClass)}},{key:"_checkInputValidity",value:function(e){"name"!==e.name&&"description"!==e.name&&"place-name"!==e.name||(this._nameRegex.test(e.value)?e.setCustomValidity(""):e.setCustomValidity("Поле может содержать только латинские и кириллические буквы, знаки дефиса и пробелы")),e.validity.valid?this._hideError(e):this._showError(e)}},{key:"setButtonState",value:function(e,t,n){t?(e.classList.remove(n.buttonInvalidClass),e.disabled=!1):(e.classList.add(n.buttonInvalidClass),e.disabled=!0)}},{key:"_setEventListeners",value:function(){var e=this;this._inputsList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e.setButtonState(e.submitButton,e.form.checkValidity(),e.config)}))}))}},{key:"enableValidation",value:function(){this._setEventListeners(),this.setButtonState(this.submitButton,this.form.checkValidity(),this.config)}},{key:"resetValidation",value:function(){var e=this;this._inputsList.forEach((function(t){e._hideError(t)})),this.setButtonState(this.submitButton,!1,this.config)}}])&&f(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var y,v=document.querySelector("#card-template"),m=document.querySelector(".places__list"),b=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),S=k.querySelector(".popup__close"),g=k.querySelector(".popup__form"),C=g.querySelector(".popup__button"),E=document.querySelector(".profile__add-button"),q=document.querySelector(".popup_type_new-card"),L=q.querySelector(".popup__close"),w=q.querySelector(".popup__form"),x=w.querySelector(".popup__button"),U=document.querySelector(".profile__image"),I=document.querySelector(".popup_type_avatar"),j=I.querySelector(".popup__close"),P=I.querySelector(".popup__form"),V=P.querySelector("#avatarLink"),A=P.querySelector(".popup__button"),T=document.querySelector(".popup_type_image"),B=T.querySelector(".popup__close"),O=T.querySelector(".popup__image"),R=T.querySelector(".popup__caption"),D=g.querySelector(".popup__input_type_name"),N=g.querySelector(".popup__input_type_description"),J=w.querySelector(".popup__input_type_card-name"),z=document.querySelector(".profile__title"),H=document.querySelector(".profile__description"),M=document.querySelector(".popup__input_type_url"),$={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputInvalidClass:"popup__input_state_invalid",buttonInvalidClass:"popup__button_invalid"},Z=new h($,g);Z.enableValidation();var F=new h($,w);F.enableValidation();var G=new h($,P);function K(e,t,n){z.textContent=e,H.textContent=t,n&&(U.style.backgroundImage="url(".concat(n,")"))}function Q(e){O.src=e.link,O.alt=e.name,R.textContent=e.name,c(T)}G.enableValidation(),Promise.all([r.getUserInfo(),r.getInitialCards()]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,c=[],u=!0,s=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return _(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],u=r[1];K(c.name,c.about,c.avatar),y=c._id,u.forEach((function(e){var t=o(e,i,v,a,Q,y);m.append(t)}))})).catch((function(e){console.log(e)})),b.addEventListener("click",(function(){var e={name:z.textContent,description:H.textContent},t=e.name,n=e.description;D.value=t,N.value=n,c(k),Z.resetValidation()})),g.addEventListener("submit",(function(e){return function(e,t){e.preventDefault(),C.textContent="Сохранение...",r.editUserInfo(D.value,N.value).then((function(e){K(e.name,e.about),u(t)})).catch((function(e){console.log(e)})).finally((function(){C.textContent="Сохранить"}))}(e,k)})),S.addEventListener("click",(function(){return u(k)})),E.addEventListener("click",(function(){c(q),F.resetValidation()})),L.addEventListener("click",(function(){return u(q)})),w.addEventListener("submit",(function(e){return function(e,t,n){e.preventDefault();var c=e.target,s={name:J.value,link:M.value};x.textContent="Сохранение...",r.addCard(s.name,s.link).then((function(e){var r=o(e,i,n,a,Q,y);m.insertBefore(r,m.firstChild),u(t),c.reset()})).catch((function(e){console.log(e)})).finally((function(){x.textContent="Сохранить"}))}(e,q,v)})),B.addEventListener("click",(function(){return u(T)})),k.addEventListener("click",(function(e){return s(e,k)})),q.addEventListener("click",(function(e){return s(e,q)})),T.addEventListener("click",(function(e){return s(e,T)})),I.addEventListener("click",(function(e){return s(e,I)})),U.addEventListener("click",(function(){c(I),G.resetValidation()})),j.addEventListener("click",(function(){return u(I)})),P.addEventListener("submit",(function(e){return function(e){e.preventDefault(),A.textContent="Сохранение...",r.editUserAvatar(V.value).then((function(e){K(e.name,e.about,e.avatar),u(I)})).catch((function(e){console.log(e)})).finally((function(){A.textContent="Сохранить"}))}(e)}))})();